// Component model of valve simulator
import unqualified ValveHAL

@runtime(.MultiThreaded)
component SimulatorImpl {
  val client : Provided<ValveHAL>

  machine {
    state Initial {
      client.setParameters(_) = {
        setNextState(Ready);
        return true;
      }
    }

    state Ready {
      client.move(_) = setNextState(Moving)
      client.isMoving() = false
    }

    state Moving {
      after(seconds(10)) = setNextState(Ready)
      client.isMoving() = true
    }
  }

}
